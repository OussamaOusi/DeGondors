<%- include("partials/header", { title: "Favoriete Quotes", bodyClass: "lotr-favorites-body" }) %>
<%- include("partials/nav") %>

<main class="favorites-page">
  <div class="favorites-container">
    <h1 class="favorites-title">Favoriete Quotes</h1>

    <% 
      const groups = {};
      favorites.forEach(fav => {
        if (!groups[fav.characterName]) groups[fav.characterName] = [];
        groups[fav.characterName].push(fav);
      });
      const filterName = filter;
    %>

    <% Object.entries(groups).forEach(([character, quotes]) => { %>
      <section class="character-group">
        <header class="group-header">
          <% if (filterName === character) { %>
            <h2 class="character-name"><%= character %> (<%= quotes.length %>)</h2>
            <a href="/favorites" class="filter-reset">Alles</a>
          <% } else { %>
            <a href="/favorites?character=<%= encodeURIComponent(character) %>" class="character-name">
              <%= character %> (<%= quotes.length %>)
            </a>
          <% } %>
          <a href="https://lotr.fandom.com/wiki/<%= encodeURIComponent(character.replace(/ /g,'_')) %>" 
             class="wiki-link" target="_blank" rel="noopener">Wiki</a>
        </header>

        <ul class="quote-list">
          <% quotes.forEach(fav => { %>
            <li class="quote-item" data-id="<%= fav._id %>">
              <p class="quote-text">“<%= fav.quote %>”</p>
              <button class="btn delete-fav">Verwijder</button>
            </li>
          <% }) %>
        </ul>
      </section>
    <% }) %>
  </div>
</main>

<%- include("partials/footer") %>
<script src="/favorites.js" defer></script>
