<%- include("partials/header", { title: "Blacklist" }) %>
<body class="lotr-blacklist-body">
<%- include("partials/nav") %>
<main class="lotr-blacklist-main">
  <h1 class="lotr-blacklist-title">Blacklist Quotes</h1>

  <% 
    const groups = {};
    blacklist.forEach(item => {
      (groups[item.characterName] ||= []).push(item);
    });
    const filterName = filter;
  %>

  <% Object.keys(groups).forEach(character => { 
       const quotes = groups[character];
       const wikiUrl = quotes[0].wikiUrl || "#";
  %>
    <section class="lotr-blacklist-group">
      <header class="blacklist-group-header">
        <% if (filterName === character) { %>
          <span class="blacklist-character-name"><%= character %> (<%= quotes.length %>)</span>
          <a href="/blacklist" class="blacklist-filter-reset">Alles</a>
        <% } else { %>
          <a href="/blacklist?character=<%= encodeURIComponent(character) %>" class="blacklist-character-name">
            <%= character %> (<%= quotes.length %>)
          </a>
        <% } %>
        <a href="<%= wikiUrl %>" class="blacklist-wiki-link" target="_blank" rel="noopener">Wiki</a>
      </header>
      <ul class="blacklist-quote-list">
        <% quotes.forEach(item => { %>
          <li class="blacklist-quote-item" data-id="<%= item._id %>">
            <blockquote class="blacklist-quote-text">“<%= item.quote %>”</blockquote>
            <div class="blacklist-reason">
              <span class="blacklist-reason-label">Reden:</span>
              <span class="blacklist-reason-content"><%= item.reason %></span>
            </div>
            <button class="btn delete-blacklist">Verwijder</button>
          </li>
        <% }) %>
      </ul>
    </section>
  <% }) %>
</main>
<script src="/api.js" defer></script>
<%- include("partials/footer") %>

